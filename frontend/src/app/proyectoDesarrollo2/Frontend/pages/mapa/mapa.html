<div class="map-page-container">

  <!-- Header bar with buttons -->
  <div class="map-header-bar">
    <div class="header-left">
      <button class="btn btn-back" (click)="router.navigate(['/main'])">â¬… Volver</button>
    </div>

    <div class="header-center">
      <h2>Gestor de Rutas</h2>
    </div>

    <div class="header-right">

      <!-- SOLO ADMIN puede crear rutas -->
      <button class="btn btn-primary" (click)="empezarCrearRuta()" *ngIf="!creandoRuta && esAdmin">
        âž• Crear Ruta
      </button>


      <!-- SOLO ADMIN puede guardar -->
      <button class="btn btn-success" 
              (click)="guardarRuta()" 
              *ngIf="creandoRuta && esAdmin">
        âœ” Guardar Ruta
      </button>

      <!-- SOLO ADMIN puede limpiar -->
      <button class="btn btn-danger" 
              (click)="limpiarMapa()" 
              *ngIf="creandoRuta && esAdmin">
        ðŸ—‘ Limpiar
      </button>

    </div>
  </div>

  <!-- Main content area: map + sidebar -->
  <div class="map-content-wrapper">

    <!-- Map section -->
    <div class="map-section">
      <div id="mapContainer"></div>
    </div>

    <!-- Sidebar -->
    <div class="routes-sidebar">
      <h3>Rutas Registradas</h3>

      <div class="routes-list-container">
        <div class="ruta-item" *ngFor="let r of rutas">
          <div class="ruta-info">
            <div class="ruta-name">{{ r.nombre_ruta }}</div>
            <div class="ruta-color" [style.background]="r.color_hex || '#10b981'"></div>
          </div>
          <button class="btn-view" (click)="mostrarRuta(r)">Ver</button>
        </div>

        <div *ngIf="rutas.length === 0" class="no-routes">
          No hay rutas registradas aÃºn
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL -->
  <div class="modal-overlay" *ngIf="mostrarModalNombreRuta" (click)="mostrarModalNombreRuta = false">
    <div class="modal" (click)="$event.stopPropagation()">

      <h3>Crear Nueva Ruta</h3>

      <div class="modal-form">
        <div class="form-group">
          <label>Nombre de la ruta</label>
          <input 
            type="text" 
            [(ngModel)]="nombreRuta"
            placeholder="Ej: Ruta Centro - Zona Norte"
            class="form-input"
            autofocus>
        </div>

        <div class="form-group">
          <label>Color de la ruta</label>
          <div class="color-picker-group">
            <input type="color" [(ngModel)]="rutaColor" class="color-picker">
            <div class="color-preview" [style.background]="rutaColor"></div>
            <div class="color-info">
              <span class="color-value">{{ rutaColor }}</span>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-buttons">
        <button class="btn btn-cancel" (click)="mostrarModalNombreRuta = false">
          Cancelar
        </button>

        <!-- SOLO ADMIN puede confirmar -->
        <button class="btn btn-primary" (click)="confirmarNombreRuta()" *ngIf="esAdmin">
          Comenzar a Dibujar
        </button>

      </div>

    </div>
  </div>

</div>

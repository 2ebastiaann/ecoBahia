<div class="vehicles-container">

  <button class="btn-secondary" (click)="goToMain()">‚¨ÖÔ∏è Volver al Inicio</button>

  <header class="header">
    <h1>Veh√≠culos</h1>

    <!-- ADMIN y CONDUCTOR pueden agregar -->
    <button class="btn-primary" (click)="openAddModal()" *ngIf="esAdmin || esConductor">
      ‚ûï Agregar Veh√≠culo
    </button>
  </header>

  <main>
    <table class="vehicles-table">
      <thead>
        <tr>
          <th>Placa</th>
          <th>Marca</th>
          <th>Modelo</th>
          <th>Activo</th>
          <th>Acciones</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let vehiculo of vehicles">
          <td>{{ vehiculo.placa }}</td>
          <td>{{ vehiculo.marca }}</td>
          <td>{{ vehiculo.modelo }}</td>
          <td>{{ vehiculo.activo ? 'S√≠' : 'No' }}</td>

          <td>
            <!-- Admin y Conductor pueden editar -->
            <button (click)="editVehicle(vehiculo)" *ngIf="esAdmin || esConductor">
              ‚úèÔ∏è Editar
            </button>

            <!-- Solo Admin elimina -->
            <button (click)="deleteVehicle(vehiculo.id!)" *ngIf="esAdmin || esConductor">
              üóëÔ∏è Eliminar
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </main>
</div>


<!-- ============================
     MODAL FUERA DEL CONTENEDOR
============================= -->
<ng-container *ngIf="showModal">
  <div class="modal-overlay" (click)="closeModal()">
    <div class="modal" (click)="$event.stopPropagation()">

      <h2>{{ isEditMode ? "Editar Veh√≠culo" : "Agregar Veh√≠culo" }}</h2>

      <form [formGroup]="vehicleForm" (ngSubmit)="onSubmit()">

        <div class="form-group">
          <label>Placa</label>
          <input 
            type="text" 
            formControlName="placa"
            placeholder="Ej: ABC-123">
        </div>

        <div class="form-group">
          <label>Marca</label>
          <input 
            type="text" 
            formControlName="marca"
            placeholder="Ej: Toyota">
        </div>

        <div class="form-group">
          <label>Modelo</label>
          <input 
            type="text" 
            formControlName="modelo"
            placeholder="Ej: 2024">
        </div>

        <div class="form-group">
          <label>Activo</label>
          <select formControlName="activo">
            <option [value]="true">S√≠</option>
            <option [value]="false">No</option>
          </select>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn-secondary" (click)="closeModal()">
            Cancelar
          </button>
          <button type="submit" class="btn-primary" [disabled]="!vehicleForm.valid">
            {{ isEditMode ? "Guardar Cambios" : "Agregar" }}
          </button>
        </div>

      </form>

    </div>
  </div>
</ng-container>
